<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gematria Matrix Visualization</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #0a0a0a;
      color: #fff;
      padding: 24px;
      min-height: 100vh;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    h1 { font-size: 24px; margin-bottom: 8px; }
    .subtitle { color: #888; margin-bottom: 24px; }

    .legend {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 12px;
      margin-bottom: 24px;
    }
    .legend-item {
      background: #18181b;
      border: 1px solid #27272a;
      border-radius: 8px;
      padding: 12px;
    }
    .legend-label { font-size: 12px; color: #71717a; margin-bottom: 4px; }
    .legend-value { font-weight: bold; }
    .legend-desc { font-size: 11px; color: #52525b; margin-top: 4px; }

    .hue-spectrum {
      height: 16px;
      border-radius: 4px;
      margin-top: 8px;
      background: linear-gradient(to right,
        hsl(0, 80%, 50%),
        hsl(60, 80%, 50%),
        hsl(120, 80%, 50%),
        hsl(180, 80%, 50%),
        hsl(240, 80%, 50%),
        hsl(300, 80%, 50%),
        hsl(360, 80%, 50%)
      );
    }

    .matrix-container {
      background: #18181b;
      border: 1px solid #27272a;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
      overflow-x: auto;
    }

    .matrix-grid {
      display: grid;
      gap: 1px;
      background: #27272a;
      border: 1px solid #27272a;
      width: fit-content;
    }

    .matrix-cell {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.1s;
      position: relative;
    }
    .matrix-cell:hover {
      transform: scale(1.1);
      z-index: 10;
      box-shadow: 0 0 10px rgba(255,255,255,0.3);
    }
    .matrix-cell.empty {
      background: #0a0a0a;
    }

    .tooltip {
      position: fixed;
      background: #18181b;
      border: 1px solid #3f3f46;
      border-radius: 8px;
      padding: 12px;
      font-size: 12px;
      pointer-events: none;
      z-index: 1000;
      max-width: 280px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      display: none;
    }
    .tooltip.visible { display: block; }
    .tooltip-phrase { font-weight: bold; font-size: 14px; margin-bottom: 8px; }
    .tooltip-values { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; }
    .tooltip-value { padding: 4px 8px; border-radius: 4px; }

    .controls {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    input, button {
      background: #18181b;
      border: 1px solid #27272a;
      border-radius: 6px;
      color: #fff;
      padding: 8px 12px;
      font-size: 14px;
    }
    input { flex: 1; min-width: 200px; }
    button {
      background: #7c3aed;
      border-color: #7c3aed;
      cursor: pointer;
    }
    button:hover { background: #6d28d9; }

    .table-container {
      background: #18181b;
      border: 1px solid #27272a;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 24px;
    }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th { background: #27272a; text-align: left; padding: 10px; }
    th.right { text-align: right; }
    td { padding: 10px; border-top: 1px solid #27272a; }
    td.right { text-align: right; font-family: monospace; }
    td.mono { font-family: monospace; }

    .color-swatch {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      display: inline-block;
      vertical-align: middle;
      margin-right: 8px;
      border: 1px solid #3f3f46;
    }

    .example {
      background: #18181b;
      border: 1px solid #27272a;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }
    .example h2 { font-size: 18px; margin-bottom: 12px; }
    .example-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }
    .example-item {
      text-align: center;
      padding: 16px;
      border-radius: 8px;
      background: #27272a;
    }
    .example-value { font-size: 28px; font-weight: bold; font-family: monospace; }
    .example-label { font-size: 12px; margin-top: 4px; color: #a1a1aa; }
    .example-attr { font-size: 11px; color: #71717a; margin-top: 2px; }

    .info-box {
      background: #1c1917;
      border: 1px solid #422006;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }
    .info-box h3 { color: #fbbf24; margin-bottom: 8px; }
    .info-box p, .info-box li { color: #a8a29e; font-size: 13px; line-height: 1.6; }
    .info-box code { background: #000; padding: 2px 6px; border-radius: 4px; color: #fbbf24; }
    .info-box ul { margin-left: 20px; margin-top: 8px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Gematria Matrix Visualization</h1>
    <p class="subtitle">Cell-by-cell grid with HSL color encoding</p>

    <div class="legend">
      <div class="legend-item">
        <div class="legend-label">Hue (H)</div>
        <div class="legend-value" style="color:#f87171">Hebrew Gematria</div>
        <div class="legend-desc">Lower values → Red | Higher values → Violet</div>
        <div class="hue-spectrum"></div>
      </div>
      <div class="legend-item">
        <div class="legend-label">Saturation (S)</div>
        <div class="legend-value" style="color:#fbbf24">Aik Bekar⁹ Repdigit Score</div>
        <div class="legend-desc">
          Weighted by: repdigit count, consecutive digits, digit value<br>
          666 > 669 > 696 > 123
        </div>
      </div>
      <div class="legend-item">
        <div class="legend-label">Lightness (L)</div>
        <div class="legend-value" style="color:#22c55e">Simple Gematria Digit Count</div>
        <div class="legend-desc">2 digits = 25% (dark) | 3 digits = 50% | 4 digits = 75% (light)</div>
      </div>
      <div class="legend-item">
        <div class="legend-label">Opacity</div>
        <div class="legend-value" style="color:#71717a">English Gematria (666)</div>
        <div class="legend-desc">Always 100% - not graphed (constant)</div>
      </div>
    </div>

    <div class="example">
      <h2>Example: "stunner" → 555/666/111/111</h2>
      <div class="example-grid" id="stunnerExample"></div>
    </div>

    <div class="matrix-container">
      <h3 style="margin-bottom: 12px; color: #a1a1aa; font-size: 14px;">Phrase Matrix (hover for details)</h3>
      <div class="matrix-grid" id="matrixGrid"></div>
    </div>

    <div class="controls">
      <input type="text" id="phraseInput" placeholder="Add a phrase to visualize...">
      <button onclick="addPhrase()">Add Phrase</button>
      <button onclick="clearPhrases()" style="background:#dc2626;border-color:#dc2626;">Clear All</button>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Color</th>
            <th>Phrase</th>
            <th class="right">Combination</th>
            <th class="right">Hebrew</th>
            <th class="right">English</th>
            <th class="right">Simple</th>
            <th class="right">Aik Bekar⁹</th>
          </tr>
        </thead>
        <tbody id="phraseTable"></tbody>
      </table>
    </div>

    <div class="info-box">
      <h3>Repdigit Saturation Scoring</h3>
      <p>The Aik Bekar value determines saturation through repdigit analysis:</p>
      <ul>
        <li><strong>Total repdigits:</strong> Count of repeated digits (666 has 3, 669 has 2)</li>
        <li><strong>Consecutive bonus:</strong> Adjacent repeats score higher (669 > 696)</li>
        <li><strong>Value weight:</strong> Higher numbers rank above (1111 > 99, 8888 > 999)</li>
      </ul>
      <p style="margin-top: 12px;">
        <strong>Formula:</strong> <code>score = (repdigitCount × 20) + (consecutiveBonus × 15) + (digitValue × digits / 10)</code>
      </p>
    </div>

    <div id="tooltip" class="tooltip"></div>
  </div>

  <script>
    // Corrected Gematria values from gematrix.org
    const hebrewValues = {
      a: 1, b: 2, c: 3, d: 4, e: 5, f: 6, g: 7, h: 8, i: 9, j: 600,
      k: 10, l: 20, m: 30, n: 40, o: 50, p: 60, q: 70, r: 80, s: 90, t: 100,
      u: 200, v: 700, w: 900, x: 300, y: 400, z: 500
    };

    const englishValues = {
      a: 6, b: 12, c: 18, d: 24, e: 30, f: 36, g: 42, h: 48, i: 54, j: 60,
      k: 66, l: 72, m: 78, n: 84, o: 90, p: 96, q: 102, r: 108, s: 114, t: 120,
      u: 126, v: 132, w: 138, x: 144, y: 150, z: 156
    };

    const simpleValues = {
      a: 1, b: 2, c: 3, d: 4, e: 5, f: 6, g: 7, h: 8, i: 9, j: 10,
      k: 11, l: 12, m: 13, n: 14, o: 15, p: 16, q: 17, r: 18, s: 19, t: 20,
      u: 21, v: 22, w: 23, x: 24, y: 25, z: 26
    };

    // Aik Bekar Base-9 values from gematrix.org
    // A B C D E F G H I J  K L M  N  O P  Q  R  S T  U  V  W X  Y  Z
    // 1 20 13 6 25 18 11 4 23 16 9 2 21 14 7 26 19 12 5 24 17 10 3 22 15 8
    const aiqBekarValues = {
      a: 1, b: 20, c: 13, d: 6, e: 25, f: 18, g: 11, h: 4, i: 23, j: 16,
      k: 9, l: 2, m: 21, n: 14, o: 7, p: 26, q: 19, r: 12, s: 5, t: 24,
      u: 17, v: 10, w: 3, x: 22, y: 15, z: 8
    };

    function calcGematria(text, values) {
      let total = 0;
      const clean = text.toLowerCase().replace(/[^a-z]/g, '');
      for (let c of clean) total += values[c] || 0;
      return total;
    }

    function calcAll(phrase) {
      return {
        phrase,
        hebrew: calcGematria(phrase, hebrewValues),
        english: calcGematria(phrase, englishValues),
        simple: calcGematria(phrase, simpleValues),
        aiqBekar: calcGematria(phrase, aiqBekarValues)
      };
    }

    // Calculate repdigit score for saturation
    function calcRepdigitScore(num) {
      const str = num.toString();
      const digits = str.split('');

      // Count character frequencies
      const freq = {};
      digits.forEach(d => freq[d] = (freq[d] || 0) + 1);

      // Count total repdigits (digits that appear more than once)
      let repdigitCount = 0;
      let maxRepeatedDigit = 0;
      let maxRepeatCount = 0;

      Object.entries(freq).forEach(([digit, count]) => {
        if (count > 1) {
          repdigitCount += count;
          if (count > maxRepeatCount || (count === maxRepeatCount && parseInt(digit) > maxRepeatedDigit)) {
            maxRepeatCount = count;
            maxRepeatedDigit = parseInt(digit);
          }
        }
      });

      // Count consecutive repeats (touching repdigits)
      let consecutiveBonus = 0;
      let currentRun = 1;
      for (let i = 1; i < digits.length; i++) {
        if (digits[i] === digits[i-1]) {
          currentRun++;
        } else {
          if (currentRun > 1) {
            consecutiveBonus += currentRun * currentRun; // Square for emphasis
          }
          currentRun = 1;
        }
      }
      if (currentRun > 1) {
        consecutiveBonus += currentRun * currentRun;
      }

      // Value weight: higher repdigit values and longer numbers score more
      // 1111 > 99, 8888 > 999
      const digitValue = maxRepeatedDigit;
      const lengthBonus = digits.length;

      // Combined score
      const score = (repdigitCount * 20) + (consecutiveBonus * 15) + (digitValue * maxRepeatCount * 2) + (lengthBonus * 5);

      return {
        score,
        repdigitCount,
        consecutiveBonus,
        maxRepeatedDigit,
        maxRepeatCount
      };
    }

    // Convert Hebrew value to Hue (0-300, red to violet)
    function hebrewToHue(hebrew, minHebrew, maxHebrew) {
      // Map to 0 (red) through 300 (violet/magenta)
      const normalized = (hebrew - minHebrew) / (maxHebrew - minHebrew || 1);
      return Math.floor(normalized * 300);
    }

    // Convert Simple digit count to Lightness
    function simpleToLightness(simple) {
      const digitCount = simple.toString().length;
      if (digitCount <= 2) return 25;  // Dark
      if (digitCount === 3) return 50; // Medium
      return 75; // Light (4+ digits)
    }

    // Convert repdigit score to Saturation (0-100)
    function scoreToSaturation(score, minScore, maxScore) {
      if (maxScore === minScore) return 50;
      const normalized = (score - minScore) / (maxScore - minScore);
      // Range from 15% (desaturated) to 100% (vivid)
      return Math.floor(15 + normalized * 85);
    }

    // Verified gematria phrases organized by Hebrew/English/Simple/AikBekar
    // Format: "phrase" // H/E/S/A
    let phrases = [
      // 11/66/11/33
      "a gaba", "baga gba",
      // 111/666/111/99
      "which", "anarcho heath fowl", "had dawn", "fish", "hand",
      // 111/666/111/333
      "decide", "cabbagehead", "diacidic", "adib decade", "heidi decade",
      // 222/666/111/55
      "a hall shall lid",
      // 222/666/111/99
      "olio", "khaldian", "lion had oil", "akpoll", "glig a lag", "hood mild fall", "hill handbook",
      "call kinghood", "locking ahold", "hang lockhole", "nail hook", "heal cloak", "holding half",
      "lark", "linga long fill han",
      // 333/666/111/99
      "act shah high", "scat hash high", "sact as high shh", "shah highs cat", "haiti has hash",
      // 444/666/111/99
      "xl male fall", "alled lack oak xl", "xml chaka mall", "khan calm lax k", "dock leak lax l",
      // 555/666/111/111
      "stunner", "lets nut", "let tour", "tor lute", "lute rot", "quest on", "uso peps", "sem stun",
      "out pose", "opus toe", "true lot", "url step", "ms tunes", "ms route", "ps serum", "sperm us",
      "mu store", "rep sums", "kurt seq", "st menus", "nut mess", "tom sure", "pst rule", "ent slut",
      "rut some", "rpm uses", "pose out", "toe soup", "net runs", "ron true",
      // 555/666/111/99
      "highland yoga", "uganda annual", "usa aka culled", "aclu facular",
      // 777/666/111/99
      "xbox add salad", "galaxy hd lake",
      // 777/666/111/111
      "xp ix hoo",
      // 888/666/111/99
      "baruch hazard", "rug raz had a ea",
      // 888/666/111/111
      "juice blade fief gf",
      // 999/666/111/99
      "black bull vala", "kama val luke",
      // 1111/666/111/99
      "lash which cap", "hiawatha hole", "flog hiawatha", "hiawatha golf", "hang sandwich",
      "aye ayahuasca", "ayahuasca yea", "a gang shag win", "hold at hawaii", "a swag hanging",
      // 1111/666/111/111
      "added add efface", "decided bidi",
      // 8888/6666/1111/1111
      "vessel therapeutic chrysazol spot travelling solutize swagman citizenries symptosis fatwa boat",
      // 5555/6666/1111/111
      "russeting poor bamoth buggery sculks aeons details nonsolubly fin psychology omoideum postmarital",
      // 6666/6666/1111/1111
      "hesperornis jurassic sensitizes polyoecy stanford silting monkeyishly physiology confidantes",
      // 7777/6666/1111/1111
      "quaestiones makers interactions disavowedly errors spermatocyst addressed apteryxes outcrows",
      // 7777/6666/1111/111
      "barway filched firlot sovereignize helicteres oversorrow state priggishness civie soldiers dansker glaciable",
      // 9999/6666/1111/111
      "www moneyflower receptary creature attention juked econometrist tight cany yertchuk simaba fellowman",
      // 333/666/111
      "cad steadies dice"
    ];

    let phraseData = phrases.map(p => {
      const data = calcAll(p);
      data.repdigitInfo = calcRepdigitScore(data.aiqBekar);
      return data;
    });

    function getColorRanges() {
      const hebrews = phraseData.map(p => p.hebrew);
      const scores = phraseData.map(p => p.repdigitInfo.score);
      return {
        minHebrew: Math.min(...hebrews),
        maxHebrew: Math.max(...hebrews),
        minScore: Math.min(...scores),
        maxScore: Math.max(...scores)
      };
    }

    function getHSLColor(data, ranges) {
      const h = hebrewToHue(data.hebrew, ranges.minHebrew, ranges.maxHebrew);
      const s = scoreToSaturation(data.repdigitInfo.score, ranges.minScore, ranges.maxScore);
      const l = simpleToLightness(data.simple);
      return `hsl(${h}, ${s}%, ${l}%)`;
    }

    function buildMatrix() {
      const grid = document.getElementById('matrixGrid');
      const ranges = getColorRanges();

      // Calculate grid dimensions (roughly square)
      const count = phraseData.length;
      const cols = Math.ceil(Math.sqrt(count));

      grid.style.gridTemplateColumns = `repeat(${cols}, 40px)`;
      grid.innerHTML = '';

      phraseData.forEach((data, idx) => {
        const cell = document.createElement('div');
        cell.className = 'matrix-cell';
        cell.style.backgroundColor = getHSLColor(data, ranges);
        cell.dataset.index = idx;

        cell.addEventListener('mouseenter', (e) => showTooltip(e, data, ranges));
        cell.addEventListener('mouseleave', hideTooltip);
        cell.addEventListener('mousemove', moveTooltip);

        grid.appendChild(cell);
      });
    }

    function showTooltip(e, data, ranges) {
      const tooltip = document.getElementById('tooltip');
      const color = getHSLColor(data, ranges);
      const h = hebrewToHue(data.hebrew, ranges.minHebrew, ranges.maxHebrew);
      const s = scoreToSaturation(data.repdigitInfo.score, ranges.minScore, ranges.maxScore);
      const l = simpleToLightness(data.simple);

      tooltip.innerHTML = `
        <div class="tooltip-phrase">
          <span class="color-swatch" style="background:${color}"></span>
          ${data.phrase}
        </div>
        <div class="tooltip-values">
          <div class="tooltip-value" style="background:#3f3f46">
            <div style="color:#f87171">Hebrew: ${data.hebrew}</div>
            <div style="font-size:10px;color:#71717a">Hue: ${h}°</div>
          </div>
          <div class="tooltip-value" style="background:#3f3f46">
            <div style="color:#71717a">English: ${data.english}</div>
            <div style="font-size:10px;color:#52525b">Always 666 (ignored)</div>
          </div>
          <div class="tooltip-value" style="background:#3f3f46">
            <div style="color:#22c55e">Simple: ${data.simple}</div>
            <div style="font-size:10px;color:#71717a">Lightness: ${l}% (${data.simple.toString().length} digits)</div>
          </div>
          <div class="tooltip-value" style="background:#3f3f46">
            <div style="color:#fbbf24">Aik Bekar: ${data.aiqBekar}</div>
            <div style="font-size:10px;color:#71717a">Saturation: ${s}%</div>
            <div style="font-size:9px;color:#52525b">Score: ${data.repdigitInfo.score}</div>
          </div>
        </div>
      `;
      tooltip.classList.add('visible');
      moveTooltip(e);
    }

    function moveTooltip(e) {
      const tooltip = document.getElementById('tooltip');
      tooltip.style.left = (e.clientX + 15) + 'px';
      tooltip.style.top = (e.clientY + 15) + 'px';
    }

    function hideTooltip() {
      document.getElementById('tooltip').classList.remove('visible');
    }

    function updateTable() {
      const tbody = document.getElementById('phraseTable');
      const ranges = getColorRanges();

      tbody.innerHTML = phraseData.map(data => {
        const color = getHSLColor(data, ranges);
        const combo = `${data.hebrew}/${data.english}/${data.simple}/${data.aiqBekar}`;
        return `
          <tr>
            <td><span class="color-swatch" style="background:${color}"></span></td>
            <td class="mono">${data.phrase}</td>
            <td class="right mono" style="color:#a78bfa">${combo}</td>
            <td class="right mono" style="color:#f87171">${data.hebrew}</td>
            <td class="right mono" style="color:#71717a">${data.english}</td>
            <td class="right mono" style="color:#22c55e">${data.simple}</td>
            <td class="right mono" style="color:#fbbf24">${data.aiqBekar}</td>
          </tr>
        `;
      }).join('');
    }

    function showStunnerExample() {
      const s = calcAll('stunner');
      const repInfo = calcRepdigitScore(s.aiqBekar);

      document.getElementById('stunnerExample').innerHTML = `
        <div class="example-item">
          <div class="example-value" style="color:#f87171">${s.hebrew}</div>
          <div class="example-label">Hebrew</div>
          <div class="example-attr">→ Hue (red-violet)</div>
        </div>
        <div class="example-item">
          <div class="example-value" style="color:#71717a">${s.english}</div>
          <div class="example-label">English</div>
          <div class="example-attr">→ Ignored (constant)</div>
        </div>
        <div class="example-item">
          <div class="example-value" style="color:#22c55e">${s.simple}</div>
          <div class="example-label">Simple</div>
          <div class="example-attr">→ Lightness (${s.simple.toString().length} digits)</div>
        </div>
        <div class="example-item">
          <div class="example-value" style="color:#fbbf24">${s.aiqBekar}</div>
          <div class="example-label">Aik Bekar⁹</div>
          <div class="example-attr">→ Saturation (score: ${repInfo.score})</div>
        </div>
      `;
    }

    function addPhrase() {
      const input = document.getElementById('phraseInput');
      const phrase = input.value.trim().toLowerCase();
      if (phrase && !phrases.includes(phrase)) {
        phrases.push(phrase);
        const data = calcAll(phrase);
        data.repdigitInfo = calcRepdigitScore(data.aiqBekar);
        phraseData.push(data);
        buildMatrix();
        updateTable();
        input.value = '';
      }
    }

    function clearPhrases() {
      // Reset to representative sample across different combinations
      phrases = [
        "stunner",           // 555/666/111/111
        "which",             // 111/666/111/99
        "decide",            // 111/666/111/333
        "act shah high",     // 333/666/111/99
        "xl male fall",      // 444/666/111/99
        "xbox add salad",    // 777/666/111/99
        "baruch hazard",     // 888/666/111/99
        "black bull vala",   // 999/666/111/99
        "lash which cap"     // 1111/666/111/99
      ];
      phraseData = phrases.map(p => {
        const data = calcAll(p);
        data.repdigitInfo = calcRepdigitScore(data.aiqBekar);
        return data;
      });
      buildMatrix();
      updateTable();
    }

    document.getElementById('phraseInput').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') addPhrase();
    });

    // Initialize
    buildMatrix();
    updateTable();
    showStunnerExample();
  </script>
</body>
</html>
